import React from "react";
import styled from "styled-components";
import { formatDistanceToNow } from "date-fns";
import { generateTimestamp } from "utils/date";
import Avatar from "components/avatar";

const statusLookup = {
  created: "#A03333",
  inprogress: "#B79312",
  completed: "#42A033",
};

const RequestContainer = styled.li`
  width: 100%;
  margin-bottom: 1rem;
  border-radius: 0.5rem;
`;

const Header = styled.header`
  padding: 0.5rem 1rem;
  background-color: ${({ status }) => statusLookup[status] || "transparent"};
  height: 32px;
  border-top-left-radius: 0.5rem;
  border-top-right-radius: 0.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
`;

const Body = styled.section`
  padding: 1rem 1rem 0 1rem;
  background-color: #222;
  border-left: 1px solid #282828;
  border-right: 1px solid #282828;
`;

const Footer = styled.footer`
  border-bottom-left-radius: 0.5rem;
  border-bottom-right-radius: 0.5rem;
  padding: 0 1rem 1rem 1rem;
  background-color: #222;
  color: #f2f2f2;
  font-weight: 700;
  line-height: 1rem;
  border: 1px solid #282828;
  border-top: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
`;

const TypeIcon = ({ type }) => {
  if (type === "debug") {
    return (
      <svg
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M16.0002 9.02812C15.9853 9.57281 15.5247 10 14.9798 10H13.2506V10.5C13.2506 11.1833 13.098 11.8307 12.8256 12.4108L14.7077 14.2929C15.0982 14.6834 15.0982 15.3166 14.7077 15.7071C14.3171 16.0977 13.684 16.0976 13.2935 15.7071L11.583 13.9966C10.8095 14.6239 9.82405 15 8.75058 15V7.375C8.75058 7.16791 8.58268 7 8.37558 7H7.62558C7.41849 7 7.25058 7.16791 7.25058 7.375V15C6.17711 15 5.19165 14.6239 4.41821 13.9966L2.70771 15.7071C2.31715 16.0977 1.68399 16.0976 1.29346 15.7071C0.90296 15.3166 0.90296 14.6834 1.29346 14.2929L3.17558 12.4108C2.90315 11.8307 2.75058 11.1833 2.75058 10.5V10H1.0214C0.476523 10 0.0159295 9.57281 0.000992003 9.02812C-0.0145392 8.463 0.438961 8 1.00059 8H2.75058V6.16422L1.29346 4.70709C0.90296 4.31656 0.90296 3.68341 1.29346 3.29288C1.68402 2.90234 2.31715 2.90234 2.70771 3.29288L4.4148 5H11.5863L13.2934 3.29291C13.684 2.90237 14.3171 2.90237 14.7077 3.29291C15.0982 3.68344 15.0982 4.31659 14.7077 4.70713L13.2506 6.16422V8H15.0006C15.5622 8 16.0157 8.463 16.0002 9.02812ZM8.03183 0C6.09883 0 4.53183 1.567 4.53183 3.5H11.5318C11.5318 1.567 9.96483 0 8.03183 0Z"
          fill="#F4F4F4"
        />
      </svg>
    );
  }

  if (type === "review") {
    return (
      <svg
        width="20"
        height="16"
        viewBox="0 0 20 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M8.71476 15.9856L6.80851 15.4325C6.60851 15.3763 6.49601 15.1669 6.55226 14.9669L10.8179 0.273155C10.8741 0.0731547 11.0835 -0.0393453 11.2835 0.0169047L13.1898 0.57003C13.3898 0.62628 13.5023 0.835654 13.446 1.03565L9.18039 15.7294C9.12101 15.9294 8.91476 16.045 8.71476 15.9856ZM5.15226 12.4794L6.51164 11.0294C6.65539 10.8763 6.64601 10.6325 6.48664 10.4919L3.65539 8.00128L6.48664 5.51065C6.64601 5.37003 6.65851 5.12628 6.51164 4.97315L5.15226 3.52315C5.01164 3.37315 4.77414 3.36378 4.62101 3.50753L0.117889 7.72628C-0.041486 7.87315 -0.041486 8.12628 0.117889 8.27315L4.62101 12.495C4.77414 12.6388 5.01164 12.6325 5.15226 12.4794ZM15.3773 12.4981L19.8804 8.27628C20.0398 8.1294 20.0398 7.87628 19.8804 7.7294L15.3773 3.5044C15.2273 3.36378 14.9898 3.37003 14.846 3.52003L13.4866 4.97003C13.3429 5.12315 13.3523 5.3669 13.5116 5.50753L16.3429 8.00128L13.5116 10.4919C13.3523 10.6325 13.3398 10.8763 13.4866 11.0294L14.846 12.4794C14.9866 12.6325 15.2241 12.6388 15.3773 12.4981Z"
          fill="#F4F4F4"
        />
      </svg>
    );
  }

  return null;
};

const CodeIcon = () => (
  <svg
    width="12"
    height="16"
    viewBox="0 0 12 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M12 3.81066V4H8V0H8.18934C8.38825 0 8.57903 0.0790312 8.71969 0.219656L11.7803 3.28031C11.921 3.42098 12 3.61174 12 3.81066ZM7.75 5C7.3375 5 7 4.6625 7 4.25V0H0.75C0.335781 0 0 0.335781 0 0.75V15.25C0 15.6642 0.335781 16 0.75 16H11.25C11.6642 16 12 15.6642 12 15.25V5H7.75ZM3.85019 12.5158C3.83503 12.5319 3.81684 12.545 3.79665 12.5541C3.77646 12.5632 3.75466 12.5683 3.73251 12.569C3.71036 12.5697 3.68829 12.5661 3.66755 12.5583C3.64682 12.5505 3.62782 12.5386 3.61166 12.5235L1.58459 10.6231C1.56776 10.6073 1.55434 10.5882 1.54517 10.5671C1.53599 10.5459 1.53126 10.5231 1.53126 10.5C1.53126 10.4769 1.53599 10.4541 1.54517 10.4329C1.55434 10.4117 1.56776 10.3927 1.58459 10.3769L3.61166 8.4765C3.62782 8.46134 3.64682 8.44952 3.66755 8.4417C3.68829 8.43388 3.71036 8.43023 3.73251 8.43094C3.75466 8.43165 3.77646 8.43672 3.79665 8.44586C3.81684 8.455 3.83503 8.46802 3.85019 8.48419L4.46203 9.13684C4.47749 9.15334 4.48948 9.17277 4.49729 9.19398C4.5051 9.2152 4.50856 9.23777 4.50748 9.26035C4.50639 9.28293 4.50078 9.30507 4.49098 9.32544C4.48117 9.34581 4.46738 9.364 4.45041 9.37894L3.17656 10.5L4.45041 11.6211C4.46738 11.636 4.48117 11.6542 4.49098 11.6746C4.50078 11.6949 4.50639 11.7171 4.50748 11.7396C4.50856 11.7622 4.5051 11.7848 4.49729 11.806C4.48948 11.8272 4.47749 11.8467 4.46203 11.8632L3.85019 12.5158ZM5.45316 14.0933L4.59525 13.8442C4.55227 13.8317 4.51601 13.8027 4.49444 13.7634C4.47287 13.7242 4.46775 13.678 4.48022 13.6351L6.40022 7.02175C6.41271 6.97877 6.44175 6.94251 6.48097 6.92094C6.52018 6.89937 6.56636 6.89425 6.60934 6.90672L7.46722 7.15578C7.4885 7.16196 7.50836 7.17227 7.52566 7.18613C7.54295 7.19998 7.55735 7.21711 7.56803 7.23653C7.57871 7.25594 7.58546 7.27728 7.58789 7.2993C7.59033 7.32133 7.5884 7.34362 7.58222 7.36491L5.66222 13.9782C5.65605 13.9995 5.64575 14.0194 5.63191 14.0367C5.61806 14.054 5.60094 14.0684 5.58153 14.0791C5.56211 14.0897 5.54078 14.0965 5.51875 14.0989C5.49673 14.1014 5.47444 14.0994 5.45316 14.0933ZM10.4779 10.6231L8.45084 12.5235C8.43468 12.5386 8.41568 12.5505 8.39495 12.5583C8.37421 12.5661 8.35214 12.5697 8.32999 12.569C8.30784 12.5683 8.28604 12.5632 8.26585 12.5541C8.24566 12.545 8.22747 12.5319 8.21231 12.5158L7.60044 11.8631C7.58498 11.8466 7.57299 11.8272 7.56518 11.806C7.55737 11.7848 7.55391 11.7622 7.55499 11.7396C7.55608 11.717 7.56169 11.6949 7.57149 11.6745C7.58129 11.6542 7.59509 11.636 7.61206 11.621L8.88594 10.5L7.61209 9.37894C7.59512 9.364 7.58133 9.34581 7.57152 9.32544C7.56172 9.30507 7.55611 9.28293 7.55502 9.26035C7.55394 9.23777 7.5574 9.2152 7.56521 9.19398C7.57302 9.17277 7.58501 9.15334 7.60047 9.13684L8.21234 8.48419C8.2275 8.46802 8.24569 8.455 8.26588 8.44586C8.28607 8.43672 8.30787 8.43165 8.33002 8.43094C8.35217 8.43023 8.37424 8.43388 8.39498 8.4417C8.41571 8.44952 8.43471 8.46134 8.45088 8.4765L10.4779 10.3769C10.4948 10.3927 10.5082 10.4117 10.5174 10.4329C10.5265 10.4541 10.5313 10.4769 10.5313 10.5C10.5313 10.5231 10.5265 10.5459 10.5173 10.5671C10.5082 10.5882 10.4947 10.6073 10.4779 10.6231Z"
      fill="#fff"
    />
  </svg>
);

const CreationTime = styled.span`
  color: #fff;
  font-weight: 700;
`;

const Request = ({
  id,
  type,
  username,
  description,
  link,
  created_at,
  accepted_at,
  completed_at,
  avatar,
  updateStatus,
}) => {
  const status = completed_at
    ? "completed"
    : accepted_at
    ? "inprogress"
    : "created";

  return (
    <RequestContainer>
      <Header status={status} onClick={updateStatus}>
        <TypeIcon type={type} />
        <CreationTime>
          {formatDistanceToNow(generateTimestamp(new Date(created_at)), {
            addSuffix: true,
          })}
        </CreationTime>
      </Header>
      <Body>
        <Avatar avatar={avatar} />
      </Body>
      <Footer>
        @{username}
        <a href={link} target="_blanks">
          <CodeIcon />
        </a>
      </Footer>
    </RequestContainer>
  );
};

export default Request;
